version: '3.4'

volumes:
  sequencer_geth_data:
  sequencer_node_data:
  l1_data:

services:
  l1:
    build:
      context: .
      dockerfile: Dockerfile.l1
    ports:
      - "9545:8545"
      - "9060:6060"
    volumes:
      - "l1_data:/db"
      - "${PWD}/genesis_l1.json:/genesis.json"
      - "${PWD}/test-jwt-secret.txt:/config/test-jwt-secret.txt"

  sequencer_geth:
    image: morphism-geth:latest
    ports:
      - "8545:8545"
      - "8546:8546"
      - "8551:8551"
      - "30303:30303"
    volumes:
      - "sequencer_geth_data:/db"
      - "${PWD}/jwt-secret.txt:/jwt-secret.txt"
      - "${PWD}/genesis_geth.json:/genesis.json"
    entrypoint: # pass the L2 specific flags by overriding the entry-point and adding extra arguments
      - "/bin/sh"
      - "/entrypoint.sh"

  sequencer_node:
    depends_on:
      - sequencer_geth
    build:
      context: ..
      dockerfile: ./ops-morphism/Dockerfile
    ports:
      - "26656:26656"
    environment:
      - EMPTY_BLOCK_DELAY=true
      - MORPH_NODE_L2_ETH_RPC=http://sequencer_geth:8545
      - MORPH_NODE_L2_ENGINE_RPC=http://sequencer_geth:8551
      - MORPH_NODE_L2_ENGINE_AUTH=jwt-secret.txt
      ## todo need to replace it to a public network
      - MORPH_NODE_L1_ETH_RPC=http://l1:8545
      - MORPH_NODE_SYNC_DEPOSIT_CONTRACT_ADDRESS=0x6900000000000000000000000000000000000001
      ## - MORPH_NODE_SYNC_START_HEIGHT=88854536
    volumes:
      - "sequencer_node_data:/data"
      - "${PWD}/jwt-secret.txt:/jwt-secret.txt"
    entrypoint:
      - "/bin/sh"
      - "/entrypoint.sh"
#
#  tx-submitter:
#    depends_on:
#      - sequencer_geth
#      - sequencer_node
#    image: tx-submitter:latest
#    command: rollup
#    environment:
#      - TX_SUBMITTER_L1_PRIVATE_KEY=ac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80
#      - TX_SUBMITTER_L2_RPC_URL=http://sequencer_geth:8545
#      - TX_SUBMITTER_L1_RPC_URL=http://ec2-18-237-143-251.us-west-2.compute.amazonaws.com:8545
#      - TX_SUBMITTER_ZKEVM_CONTRACT_ADDRESS=0x6900000000000000000000000000000000000010
#      - TX_SUBMITTER_EVENT_NAME=SubmitBatches
#      - TX_SUBMITTER_ROLLUP_FUNC_NAME=SubmitBatches
#      - TX_SUBMITTER_BATCH_BLOCK_NUM=1
#      - TX_SUBMITTER_BATCH_NUM=1
#      - TX_SUBMITTER_FIRST_TIME=true
#      - TX_SUBMITTER_CHAIN_ID=900